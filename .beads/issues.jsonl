{"id":"sequelizer-2wm","title":"Consolidate JSON aggregation functions from summarb","description":"Move JSON aggregation functions from summarb/rdbms_adapter to sequelizer Platform.\n\nFunctions:\n- json_group_object() - aggregate key-value pairs into JSON object\n- json_object() - create JSON object from arguments\n\nDatabase-specific implementations:\n- PostgreSQL: JSON_OBJECT_AGG\n- DuckDB: JSON_GROUP_OBJECT\n- Athena: MAP_AGG with JSON formatting\n- Snowflake: OBJECT_AGG with TO_JSON","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:52.742532408-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:05:52.742532408-08:00","dependencies":[{"issue_id":"sequelizer-2wm","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:12.499777458-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-2wm","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:06:29.506367806-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-45h","title":"Deduplicate cold_col extension (exists in both sequelizer and conceptql)","description":"The cold_col extension exists in both:\n- sequelizer: lib/sequel/extensions/cold_col.rb (CANONICAL)\n- conceptql: lib/sequel/extensions/cold_col.rb (TO BE REMOVED)\n\nActions:\n1. Compare implementations to identify any features in conceptql's version missing from sequelizer\n2. Merge any missing functionality into sequelizer's version\n3. Update conceptql to require 'sequel/extensions/cold_col' from sequelizer gem\n4. Remove conceptql's duplicate copy\n\nSequelizer is the single source of truth for this extension.","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:06:13.821892617-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:07:06.899069011-08:00","dependencies":[{"issue_id":"sequelizer-45h","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:22.041834658-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-5kx","title":"Assess and consolidate RDBMS functions from summarb, roobetl, conceptql, t_shank","description":"# RDBMS Function Consolidation Epic\n\n## Overview\nConsolidate database-specific functions, adapters, and Sequel extensions from four projects into sequelizer as the single source of truth.\n\n## Source Projects\n- **summarb**: Statistical functions (mean, median, quantile, variance), JSON aggregation, DuckDB/Athena/Snowflake adapters\n- **roobetl**: Table naming helpers, Sequel extensions (expandable_columns, rangeable_columns, overwrite_view, empty_ctas, extensionable)\n- **conceptql**: RDBMS adapters (Postgres, Spark, Presto), Sequel extensions (cold_col, pg_ctas_explain, pg_vacuum_table)\n- **t_shank**: RDBMS adapters with export prep, date arithmetic, schema discovery, sqls extension\n\n## Consolidation Tiers\n\n### Tier 1 - Core Adapters (HIGH)\n- Unify RDBMS adapter patterns from all four projects\n- Create SequelDB::Adapter system with factory pattern\n- Support: PostgreSQL, Spark, DuckDB, Athena, Snowflake, Impala\n\n### Tier 2 - Sequel Extensions (MEDIUM)\n- pg_ctas_explain, pg_vacuum_table (from conceptql)\n- expandable_columns, rangeable_columns, overwrite_view, empty_ctas (from roobetl)\n- extensionable for SQLite (from roobetl)\n- Deduplicate cold_col (already in both sequelizer and conceptql)\n\n### Tier 3 - Utility Functions (LOWER)\n- Statistical functions (mean, median, quantile, variance)\n- Date arithmetic (date_diff, day_diff, days_between, ymd_date)\n- JSON aggregation (json_group_object, json_object)\n- Table naming helpers with schema/prefix support\n\n## Key Files to Review\n- summarb: lib/summarb/rdbms_adapter.rb + adapters/\n- roobetl: lib/formulas/db_helper.rb + lib/sequel/extensions/\n- conceptql: lib/conceptql/rdbms.rb + lib/conceptql/rdbms/\n- t_shank: lib/t_shank/rdbms_adapter/","status":"open","priority":2,"issue_type":"epic","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:21.081935017-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:05:32.766702096-08:00"}
{"id":"sequelizer-7xh","title":"Unify RDBMS adapter factory pattern across projects","description":"Create unified adapter factory system in sequelizer that consolidates patterns from:\n- summarb: RdbmsAdapter.for(adapter_type, characteristics)\n- conceptql: Rdbms.for(db) \n- t_shank: RdbmsAdapter::Adapter.for(db)\n\nDesign goals:\n1. Single factory: Sequelizer::Adapter.for(db) or Platform.adapter_for(db)\n2. Support all databases: PostgreSQL, Spark, DuckDB, Athena, Snowflake, Impala\n3. Register custom adapters: Sequelizer::Adapter.register(:mydb, MyAdapter)\n4. Provide extension points for project-specific customization\n\nThis is foundational - other consolidation tasks build on this.","status":"open","priority":1,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:06:14.151998552-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:06:14.151998552-08:00","dependencies":[{"issue_id":"sequelizer-7xh","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:22.105549254-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-7yh","title":"Implement Platform extension with KVCSV config loading","description":"Create lib/sequel/extensions/platform.rb\n\nCore functionality:\n- Load and stack CSV configs based on database adapter type\n- Provide supports?(feature) and prefers?(feature) methods that read from config\n- Provide hash-style access for arbitrary config values: platform[:interim_schema]\n- Auto-detect RDBMS from db.adapter_scheme and load appropriate CSV stack\n- Register as Sequel extension: Database.register_extension(:platform, Platform)\n\nThe Platform module should:\n1. Define Base class with KVCSV config loading\n2. Define minimal RDBMS subclasses (Postgres, Spark, Snowflake) for function translations\n3. Attach to db as db.platform via self.extended(db)\n\nDepends on: sequelizer-caa (CSV configs)","status":"closed","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T13:42:28.963019559-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:00:09.367686601-08:00","closed_at":"2026-01-21T15:00:09.367686601-08:00","close_reason":"Implemented Platform extension with KVCSV config loading. Includes Base class with supports?/prefers?/[] methods, RDBMS subclasses (Postgres, Spark, Snowflake, Athena) with function translations, auto-detection from adapter scheme, and comprehensive tests. All 161 tests pass.","dependencies":[{"issue_id":"sequelizer-7yh","depends_on_id":"sequelizer-caa","type":"blocks","created_at":"2026-01-21T13:45:26.114596506-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-aib","title":"Port CTE extraction logic from ConceptQL","description":"Create lib/sequel/extensions/cte_extraction.rb\n\n**IMPORTANT: This MUST be implemented as a Sequel extension if at all possible.**\n\nPort the CTE extraction logic from ConceptQL's Scope class (lib/conceptql/scope.rb lines 222-340).\n\nComponents to port:\n1. CteExtractor class (Sequel::ASTTransformer subclass)\n2. recursive_extract_ctes method - walks dataset and extracts WITH clauses\n3. recursive_extract_cte_expr method - handles FROM/JOIN expressions\n\nNew components to create:\n1. Extractor class - manages extraction state and collected CTEs\n2. CteExecutor class - wraps query + extracted CTEs, handles temp table lifecycle\n3. DatasetMethods module - adds with_cte_extraction method to datasets\n\nBehavior driven by platform config:\n- prefers_cte: true → return dataset unchanged\n- prefers_cte: false + supports_temp_tables: true → use TEMPORARY tables\n- prefers_cte: false + supports_temp_tables: false → use interim_schema with prefix\n\nHandle platform quirks via config:\n- drop_table_needs_unquoted for Athena\n- interim_schema and interim_prefix for non-temp-table platforms\n\nDepends on: sequelizer-7yh (Platform extension)","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T13:42:47.992907641-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:49:41.416960548-08:00","dependencies":[{"issue_id":"sequelizer-aib","depends_on_id":"sequelizer-7yh","type":"blocks","created_at":"2026-01-21T13:45:26.310298107-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-b6t","title":"Integrate existing funky.rb with Platform extension","description":"The current lib/sequel/extensions/funky.rb has partial function translation for Spark and DuckDB.\n\nOptions:\n1. Merge funky.rb functionality into Platform classes\n2. Have Platform delegate to Funky for backward compatibility\n3. Deprecate funky.rb in favor of Platform\n\nRecommended: Option 1 - merge into Platform classes\n\nMove existing functions from FunkySpark and FunkyDuckDB:\n- str_to_date\n- hash\n- make_json_column  \n- collect_list\n\nUpdate any code that uses db.funky to use db.platform instead.\n\nThis is optional/low priority - can be done after core implementation works.\n\nDepends on: sequelizer-q0k (function translations)","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T13:43:06.770895284-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T13:43:06.770895284-08:00","dependencies":[{"issue_id":"sequelizer-b6t","depends_on_id":"sequelizer-q0k","type":"blocks","created_at":"2026-01-21T13:45:26.44640022-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-caa","title":"Add kvcsv dependency and create base CSV configuration files","description":"Add kvcsv gem to sequelizer.gemspec.\n\nCreate config/platforms/ directory structure:\n- config/platforms/base.csv - conservative defaults for all capabilities\n- config/platforms/rdbms/postgres.csv - PostgreSQL overrides\n- config/platforms/rdbms/spark.csv - Spark overrides  \n- config/platforms/rdbms/snowflake.csv - Snowflake overrides\n\nBase CSV should include:\n- supports_cte, supports_temp_tables, supports_temp_views\n- prefers_cte, prefers_parquet\n- drop_table_needs_unquoted, temp_table_needs_schema\n\nReference: complete_platform_feature_matrix.csv in the plans directory","status":"closed","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T13:42:19.847910625-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T13:51:02.223851318-08:00","closed_at":"2026-01-21T13:51:02.223851318-08:00","close_reason":"Added kvcsv dependency to gemspec. Created config/platforms/ directory with base.csv and RDBMS-specific configs for postgres, spark, snowflake, and athena. Verified config loading with KVCSV stacking."}
{"id":"sequelizer-cxh","title":"Consolidate statistical functions from summarb (mean, median, quantile, variance)","description":"Move statistical aggregation functions from summarb/rdbms_adapter to sequelizer Platform.\n\nFunctions to bring:\n- count_one() - COUNT(1) expression\n- mean() - average calculation (AVG, or MEAN for DuckDB)\n- stddev() - standard deviation\n- variance() - VAR_POP across databases\n- min_date(col) / max_date(col) - date min/max\n- median_date() - PERCENTILE_CONT/MEDIAN per database\n- quantile() - percentile calculations\n\nDatabase-specific implementations exist for: PostgreSQL, DuckDB, Athena, Snowflake\n\nEach function returns a Sequel expression, not raw SQL strings.","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:52.424745818-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:49:29.321527212-08:00","dependencies":[{"issue_id":"sequelizer-cxh","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:12.437160726-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-cxh","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:06:29.43981094-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-dfc","title":"Consolidate export preparation functions from t_shank","description":"Move export preparation utilities from t_shank/rdbms_adapter to sequelizer.\n\nFunctions:\n- prep_for_export() - Configure database for export operations\n  - PostgreSQL: Set search_path, disable nested loop joins\n  - Spark: Create schema, load parquet files\n  - Impala: USE database statement\n- create_table_options() - Database-specific CREATE TABLE options\n- ymd_date() - Format date as YYYYMMDD string\n\nThese support data export workflows.","status":"closed","priority":3,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:54.129761507-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:07:23.126505375-08:00","closed_at":"2026-01-21T15:07:23.126505375-08:00","close_reason":"Export preparation is t_shank-specific workflow logic, not a general-purpose database utility. Should stay in t_shank.","dependencies":[{"issue_id":"sequelizer-dfc","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:12.790382913-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-dfc","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:06:29.829026885-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-dgk","title":"Consolidate PostgreSQL-specific extensions from conceptql","description":"Move PostgreSQL-specific Sequel extensions from conceptql to sequelizer.\n\nExtensions to migrate:\n- pg_ctas_explain.rb - EXPLAIN ANALYZE for CREATE TABLE AS\n- pg_vacuum_table.rb - VACUUM [ANALYZE] table utility\n\nThese are PostgreSQL-specific utilities for performance tuning and maintenance.","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:53.438049627-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:05:53.438049627-08:00","dependencies":[{"issue_id":"sequelizer-dgk","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:12.626381842-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-grs","title":"Consolidate Athena alterations extension from summarb","description":"Move Athena-specific Sequel extension from summarb to sequelizer.\n\nExtension: athena_alterations.rb\n- Removes quotes from DROP TABLE statements (Athena requirement)\n- Adds FORMAT clause support to CREATE TABLE\n- Overrides supports_temporary_table?() =\u003e false\n\nThis is needed for AWS Athena/Trino compatibility.","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:06:13.458450383-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:06:13.458450383-08:00","dependencies":[{"issue_id":"sequelizer-grs","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:21.980832983-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-grs","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:06:29.63295799-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-i0e","title":"Consolidate Sequel extensions from roobetl","description":"Move general-purpose Sequel extensions from roobetl to sequelizer.\n\nExtensions to migrate:\n- overwrite_view.rb - create_view! with drop-if-exists\n- empty_ctas.rb - Create empty table from column definitions\n- extensionable.rb - SQLite extension loading (sqlean)\n\nNOT migrating (roobetl-specific):\n- expandable_columns.rb - too tied to roobetl's JSON expansion workflow\n- rangeable_columns.rb - too tied to roobetl's range expansion workflow","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:53.058185138-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:07:42.682328415-08:00","dependencies":[{"issue_id":"sequelizer-i0e","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:12.563523323-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-ipa","title":"Consolidate schema/database discovery functions","description":"Move database introspection utilities from t_shank to sequelizer Platform.\n\nFunctions:\n- database_list() - Query available schemas/databases\n- bad_name?() - Filter system schemas (template*, information_schema, pg_catalog)\n\nDatabase-specific implementations:\n- PostgreSQL: information_schema query\n- Spark/Impala: SHOW DATABASES","status":"closed","priority":3,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:05:53.825533147-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:49:28.344806036-08:00","closed_at":"2026-01-21T15:49:28.344806036-08:00","close_reason":"Sequel already provides database/schema introspection. T_shank's implementation is project-specific.","dependencies":[{"issue_id":"sequelizer-ipa","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:12.729714599-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-ipa","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:06:29.764348602-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-q0k","title":"Implement platform-specific function translations","description":"Add function translation methods to Platform classes.\n\nFunctions to implement (based on ConceptQL/TShank analysis):\n- date_diff(from, to) - date difference calculation\n- cast_date(expr) - cast to date type\n- str_to_date(value, format) - parse string to date\n- days_between(from, to) - days between dates\n\nPlatform-specific implementations:\n- Postgres: date subtraction syntax, standard casting\n- Spark: reversed datediff args, to_date function\n- Snowflake: datediff with 'day' unit parameter\n\nEach function should return a Sequel expression (Sequel.function, Sequel.lit, etc.), NOT raw SQL strings.\n\nReference existing implementations in:\n- conceptql/lib/conceptql/rdbms/\n- t_shank/lib/t_shank/rdbms_adapter/\n\nDepends on: sequelizer-7yh (Platform extension)","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T13:42:37.68776951-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T13:42:37.68776951-08:00","dependencies":[{"issue_id":"sequelizer-q0k","depends_on_id":"sequelizer-7yh","type":"blocks","created_at":"2026-01-21T13:45:26.241723924-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-q0k","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:05:52.110313514-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-q0k","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:06:29.569431516-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-reb","title":"Consolidate table naming helpers from roobetl","description":"Move table naming utilities from roobetl/db_helper to sequelizer.\n\nFunctions:\n- interim_table_name() - Add prefix and schema qualification\n- source_table_name() - Apply source schema/prefix\n- vocabulary_table_name() - Vocabulary-specific naming\n- target_table_name() - Target table naming with schema\n- table_named_from_settings() - Parse dot-notation table names\n\nThese support ETL workflows with consistent table naming patterns.","status":"closed","priority":3,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:06:13.118094981-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:07:47.923640223-08:00","closed_at":"2026-01-21T15:07:47.923640223-08:00","close_reason":"Table naming helpers are roobetl ETL-workflow-specific. Should stay in roobetl.","dependencies":[{"issue_id":"sequelizer-reb","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:06:21.883321452-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-sfe","title":"Add supports_* capability methods to Platform","description":"Add capability-checking methods to Platform that mirror Sequel's supports_* pattern.\n\nMethods to add:\n- supports_temporary_table? - Check KVCSV setting, default varies by adapter\n- supports_materialized? - Materialized view support (Postgres yes, Presto no)\n- Other supports_* as needed\n\nImplementation:\n- Each method checks KVCSV for an explicit setting first\n- Falls back to sensible defaults per adapter type\n- Similar pattern to Sequel::Database#supports_* methods\n\nExample:\n  platform.supports_temporary_table?  # checks kvcsv['supports_temporary_table'] or defaults\n\nThis provides a consistent interface for capability checking across all adapters.","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T15:49:42.388734927-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T15:49:42.388734927-08:00","dependencies":[{"issue_id":"sequelizer-sfe","depends_on_id":"sequelizer-5kx","type":"blocks","created_at":"2026-01-21T15:49:48.703963987-08:00","created_by":"Ryan Duryea"},{"issue_id":"sequelizer-sfe","depends_on_id":"sequelizer-7xh","type":"blocks","created_at":"2026-01-21T15:49:48.771232148-08:00","created_by":"Ryan Duryea"}]}
{"id":"sequelizer-ztz","title":"Add comprehensive tests for Platform and CTE extraction","description":"Create tests using Sequel::Mock::Database for SQL generation validation.\n\nTest files to create:\n- test/lib/sequel/extensions/test_platform.rb\n- test/lib/sequel/extensions/test_cte_extraction.rb\n\nPlatform extension tests:\n- Config loading from CSV files\n- Config stacking/override behavior\n- supports?/prefers? methods\n- Function translation returns correct Sequel expressions\n- Auto-detection of RDBMS from adapter\n\nCTE extraction tests:\n- Simple CTE extraction\n- Nested CTE extraction\n- CTE in JOINs\n- CTE in WHERE subqueries\n- CTE in UNION compounds\n- Temp table naming with prefix\n- Interim schema qualification when no temp tables\n- Cleanup on success and failure\n\nUse Mock database to capture SQL without real connections.\nTest across simulated Postgres, Spark, and Athena configurations.\n\nDepends on: sequelizer-aib (CTE extraction)","status":"open","priority":2,"issue_type":"task","owner":"aguynamedryan@gmail.com","created_at":"2026-01-21T13:42:57.006727435-08:00","created_by":"Ryan Duryea","updated_at":"2026-01-21T13:42:57.006727435-08:00","dependencies":[{"issue_id":"sequelizer-ztz","depends_on_id":"sequelizer-aib","type":"blocks","created_at":"2026-01-21T13:45:26.37466602-08:00","created_by":"Ryan Duryea"}]}
